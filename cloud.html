<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pangeo Cloud &#8212; Pangeo  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/pangeo-style.css?v=0dbad12f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/example_gallery_styles_patched.css?v=417c3662" />
    <link rel="stylesheet" type="text/css" href="_static/pangeo-main-site-custom.css?v=91edfa83" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=30646c52"></script>
    <script src="_static/js/jquery-1.11.0.min.js"></script>
    <script src="_static/js/jquery-fix.js"></script>
    <script src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="_static/bootstrap-sphinx.js"></script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pangeo and Data" href="data.html" />
    <link rel="prev" title="Installing Pangeo on Azure" href="setup_guides/azure.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
            <span><img src="_static/small_e_reversed_24px.png"></span>
          Pangeo</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://medium.com/pangeo">Blog</a></li>
                <li><a href="https://discourse.pangeo.io">Forum</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About Pangeo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#mission-statement">Mission Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#goals">Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#get-involved">Get Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#governance">Governance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Guide for Scientists</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#learn-about-pangeo-software">Learn About Pangeo Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#explore-the-use-cases">Explore the Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#try-out-a-pangeo-environment">Try Out a Pangeo Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#give-feedback">Give Feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#contribute-a-use-case">Contribute a Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#contribute-data">Contribute Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#become-an-open-source-contributor">Become an Open Source Contributor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="packages.html#pangeo-core-packages">Pangeo Core Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#pangeo-affiliated-packages">Pangeo Affiliated Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#guidelines-for-new-packages">Guidelines for New Packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Pangeo Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Technical Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#where-we-began">Where we began</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#interoperability-in-pangeo">Interoperability in Pangeo</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#software">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#compute-platforms">Compute Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#storage-formats">Storage Formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup_guides/index.html">Deployment Setup Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="setup_guides/index.html#setting-up-pangeo-on-hpc-systems">Setting up Pangeo on HPC Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup_guides/index.html#setting-up-pangeo-on-cloud-systems">Setting up Pangeo on Cloud Systems</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pangeo Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#operated-by-2i2c">Operated by 2i2c</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-support">Getting Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sign-up">Sign Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hubs">Hubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#software-environment">Software Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-environment">Hardware Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#files-and-data-in-the-cloud">Files and Data in the Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dask">Dask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Pangeo and Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#data-on-hpc">Data on HPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#data-in-the-cloud">Data in the Cloud</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Pangeo Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="collaborators.html">Funders and Collaborators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="collaborators.html#funding-agencies">Funding Agencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborators.html#institutions">Institutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborators.html#people">People</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="publications.html#self-reported">Self-Reported</a></li>
<li class="toctree-l2"><a class="reference internal" href="publications.html#reporting-form">Reporting Form</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pangeo-showcase.html">Pangeo Showcase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pangeo-showcase.html#winter-spring-2024-showcase">Winter/Spring 2024 Showcase</a></li>
<li class="toctree-l2"><a class="reference internal" href="pangeo-showcase.html#fall-2023-showcase">Fall 2023 Showcase</a></li>
<li class="toctree-l2"><a class="reference internal" href="pangeo-showcase.html#showcase-archive">Showcase Archive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="meeting-notes.html">Meeting Schedule and Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="meeting-notes.html#community-meeting">Community Meeting</a></li>
<li class="toctree-l2"><a class="reference internal" href="meeting-notes.html#continental-community-meetings">Continental Community Meetings</a></li>
<li class="toctree-l2"><a class="reference internal" href="meeting-notes.html#working-group-meetings">Working Group Meetings</a></li>
<li class="toctree-l2"><a class="reference internal" href="meeting-notes.html#meetings-calendar">Meetings Calendar</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="meetings/index.html">Pangeo Conferences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="meetings/index.html#past-meetings">Past Meetings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Pangeo Roadmap</a><ul>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#supporting-the-pangeo-community">Supporting the Pangeo Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#supporting-the-evoloution-of-the-geoscience-software-stack">Supporting the Evoloution of the Geoscience Software Stack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact Pangeo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contact.html#discourse">Discourse</a></li>
<li class="toctree-l2"><a class="reference internal" href="contact.html#github">Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="contact.html#other-media">Other Media</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Pangeo Cloud</a><ul>
<li><a class="reference internal" href="#operated-by-2i2c">Operated by 2i2c</a></li>
<li><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li><a class="reference internal" href="#getting-support">Getting Support</a></li>
<li><a class="reference internal" href="#sign-up">Sign Up</a></li>
<li><a class="reference internal" href="#hubs">Hubs</a></li>
<li><a class="reference internal" href="#software-environment">Software Environment</a></li>
<li><a class="reference internal" href="#hardware-environment">Hardware Environment</a></li>
<li><a class="reference internal" href="#files-and-data-in-the-cloud">Files and Data in the Cloud</a></li>
<li><a class="reference internal" href="#dask">Dask</a><ul>
<li><a class="reference internal" href="#guidelines-for-using-dask">Guidelines for using Dask</a></li>
<li><a class="reference internal" href="#dask-gateway">Dask Gateway</a></li>
<li><a class="reference internal" href="#environment-variables-on-the-cluster">Environment variables on the cluster</a></li>
<li><a class="reference internal" href="#dask-software-environment">Dask Software Environment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="setup_guides/azure.html" title="Previous Chapter: Installing Pangeo on Azure"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Installing Pa...</span>
    </a>
  </li>
  <li>
    <a href="data.html" title="Next Chapter: Pangeo and Data"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Pangeo and Data &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
            
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Pangeo Cloud</a><ul>
<li><a class="reference internal" href="#operated-by-2i2c">Operated by 2i2c</a></li>
<li><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li><a class="reference internal" href="#getting-support">Getting Support</a></li>
<li><a class="reference internal" href="#sign-up">Sign Up</a></li>
<li><a class="reference internal" href="#hubs">Hubs</a></li>
<li><a class="reference internal" href="#software-environment">Software Environment</a></li>
<li><a class="reference internal" href="#hardware-environment">Hardware Environment</a></li>
<li><a class="reference internal" href="#files-and-data-in-the-cloud">Files and Data in the Cloud</a></li>
<li><a class="reference internal" href="#dask">Dask</a><ul>
<li><a class="reference internal" href="#guidelines-for-using-dask">Guidelines for using Dask</a></li>
<li><a class="reference internal" href="#dask-gateway">Dask Gateway</a></li>
<li><a class="reference internal" href="#environment-variables-on-the-cluster">Environment variables on the cluster</a></li>
<li><a class="reference internal" href="#dask-software-environment">Dask Software Environment</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="widget navlinks">
  <ul class="this-page-menu">
    <li><a href="https://github.com/pangeo-data/pangeo/blob/master/docs/cloud.rst"
            rel="nofollow"
            target="_blank"><span class="fa-stack fa-md"><i class="fa fa-github fa-stack-1x"></i></span> Edit on GitHub</a></li>
  </ul>
</div>
        </div>
      </div>
    <div class="col-md-9 content ">
      
  <section id="pangeo-cloud">
<span id="cloud"></span><h1>Pangeo Cloud<a class="headerlink" href="#pangeo-cloud" title="Link to this heading">¶</a></h1>
<p>Pangeo Cloud is an experimental service providing cloud-based data-science environments.
Pangeo Cloud is currently supported by the NSF EarthCube program <a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2026932">award 2026932</a>,
which also supports <a class="reference external" href="https://pangeo-forge.readthedocs.io/">Pangeo Forge</a>.
Funding is in place through the end of 2023. After that, we can make no firm committments about the longevity of the platform.</p>
<section id="operated-by-2i2c">
<h2>Operated by 2i2c<a class="headerlink" href="#operated-by-2i2c" title="Link to this heading">¶</a></h2>
<p>Pangeo Cloud is operated by <a class="reference external" href="https://2i2c.org">2i2c</a>.
You can see the deployment configuration here: <a class="reference external" href="https://github.com/2i2c-org/infrastructure/tree/master/config/clusters/pangeo-hubs">https://github.com/2i2c-org/infrastructure/tree/master/config/clusters/pangeo-hubs</a></p>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h2>
<embed>
  <a href="https://us-central1-b.gcp.pangeo.io" class="btn btn-primary btn-lg btn-block" >Google Cloud Deployment</a>
</embed></section>
<section id="getting-support">
<h2>Getting Support<a class="headerlink" href="#getting-support" title="Link to this heading">¶</a></h2>
<p>We would like for Pangeo Cloud to one day be a full-featured, professional
service. <strong>But it’s not yet!</strong>
It is an experiment, run by scientists and hackers who devote
their nights and weekends to this project.
Professional level support (a service-level agreement, a 24-hour helpdesk) is non-existent.</p>
<p>With those caveats, support requests for Pangeo Cloud can be made on our Discourse forum</p>
<ul class="simple">
<li><p><a class="reference external" href="https://discourse.pangeo.io/c/Cloud/Tech-support-forum-for-Pangeo-Cloud/17">https://discourse.pangeo.io/c/Cloud/Tech-support-forum-for-Pangeo-Cloud/17</a></p></li>
</ul>
<p>We use this forum to track technical support requests for Pangeo Cloud.
Someone will do their best to respond to you as quickly as possible given the circumstances.
This is not a place for general support requests about scientific python.
This forum is specific to issues related to Pangeo Cloud such as:</p>
<ul class="simple">
<li><p>login problems</p></li>
<li><p>environment configuration</p></li>
<li><p>reading / writing cloud data</p></li>
<li><p>Dask Gateway on Pangeo Cloud</p></li>
</ul>
<p>In making a support request, please provide the following information:</p>
<ul class="simple">
<li><p>Which cluster are you using (e.g. <code class="docutils literal notranslate"><span class="pre">us-central1-b.gcp.pangeo.io</span></code>)</p></li>
<li><p>A concise summary of your problem</p></li>
<li><p>If your problem involves code, please do your best to include a
<a class="reference external" href="https://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports">minimum reproducible example</a></p></li>
</ul>
</section>
<section id="sign-up">
<h2>Sign Up<a class="headerlink" href="#sign-up" title="Link to this heading">¶</a></h2>
<p>Pangeo Cloud is available to researchers across the world engaged in
data-intensive Earth and Environmental Science.
Prospective users must apply using the following form:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://forms.gle/J3hVVBgobwpYVWHF8">Pangeo Cloud Application</a></p></li>
</ul>
<p>Access will be granted based on a review of the proposed research project
and its technical suitability for Pangeo Cloud.</p>
<p>If your application is approved, you will receive an invitation to join
a GitHub Team in the <code class="docutils literal notranslate"><span class="pre">pangeo-data</span></code> organization.
You must accept this invitation to gain access to Pangeo Cloud resources.</p>
</section>
<section id="hubs">
<h2>Hubs<a class="headerlink" href="#hubs" title="Link to this heading">¶</a></h2>
<p>Currently active Pangeo JupyterHubs depend on grant funding:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://us-central1-b.gcp.pangeo.io/">us-central1-b.gcp.pangeo.io</a>: A hub in
Google Cloud Platform.</p></li>
</ul>
<p>We recommend choosing a hub based on what data you want to access. See for example
<a class="reference external" href="https://cloud.google.com/datasets">Google Cloud Datasets</a>.)</p>
<p>Once your application is approved, you will be able to log in to the resources
you requested.</p>
</section>
<section id="software-environment">
<span id="cloud-software-environment"></span><h2>Software Environment<a class="headerlink" href="#software-environment" title="Link to this heading">¶</a></h2>
<p>JupyterHubs contains a customized data-science software environment based
off the docker images built in <a class="reference external" href="https://github.com/pangeo-data/pangeo-docker-images">https://github.com/pangeo-data/pangeo-docker-images</a>.
These are the steps for adding a package to the environment:</p>
<ol class="arabic simple">
<li><p>Make a pull request to <a class="reference external" href="https://github.com/pangeo-data/pangeo-docker-images">https://github.com/pangeo-data/pangeo-docker-images</a>
updating the <cite>environment.yml</cite> file for the <cite>pangeo-notebook</cite> docker image
at <a class="reference external" href="https://github.com/pangeo-data/pangeo-docker-images/blob/master/pangeo-notebook/environment.yml">https://github.com/pangeo-data/pangeo-docker-images/blob/master/pangeo-notebook/environment.yml</a>.</p></li>
<li><p>When that pull request is merged, the Pangeo maintainers will push a tag
with today’s date, triggering a release of new docker images.</p></li>
<li><p>A bot will submit a pull request to <cite>pangeo-cloud-federation</cite> updating the
images (<a class="reference external" href="https://github.com/pangeo-data/pangeo-cloud-federation/pull/733">https://github.com/pangeo-data/pangeo-cloud-federation/pull/733</a>).
When this is merged, you can test your changes in the staging environment
(at either <a class="reference external" href="https://staging.us-central1-b.gcp.pangeo.io">https://staging.us-central1-b.gcp.pangeo.io</a> or <a class="reference external" href="https://staging.aws-uswest2.pangeo.io">https://staging.aws-uswest2.pangeo.io</a>)</p></li>
<li><p>If things look good, the Pangeo maintainers can trigger a deploy to production,
making the package avaiable to everyone.</p></li>
</ol>
<p>Users may use <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span></code> to install new packages in their own
environments, but this approach currently has some limitations noted below.
To install into your personal environment, it’s crucial that you include the
<code class="docutils literal notranslate"><span class="pre">--user</span></code> flag to pip. This installs the package in <code class="docutils literal notranslate"><span class="pre">~/.local/lib/PYTHON/site-packages/</span></code>.
Since it’s in your home directory, it will persist across jupyterlab sessions.</p>
<ul class="simple">
<li><p>Changes in the environment are not propagated to Dask ps (though see
below for a way to include packages on the workers too).</p></li>
<li><p>Installing additional packages with pip into an existing conda environment
risks breaking the environment if doesn’t see packages installed by conda and
vice versa. You shouldn’t install / update packages that are already in
the environment.</p></li>
</ul>
</section>
<section id="hardware-environment">
<h2>Hardware Environment<a class="headerlink" href="#hardware-environment" title="Link to this heading">¶</a></h2>
<p>Pangeo Cloud clusters offer different amounts of RAM and CPU to the user
notebook upon login.
Please choose the least resource-intensive option for the work you need to do.
Larger virtual machines cost us more money.</p>
</section>
<section id="files-and-data-in-the-cloud">
<h2>Files and Data in the Cloud<a class="headerlink" href="#files-and-data-in-the-cloud" title="Link to this heading">¶</a></h2>
<p>Please see the 2i2c documentation on <a class="reference external" href="https://docs.2i2c.org/en/latest/user/storage.html">Files and Data in the Cloud</a>.</p>
</section>
<section id="dask">
<h2>Dask<a class="headerlink" href="#dask" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://dask.pydata.org/">Dask</a> is an important component of Pangeo Cloud and can be used to help parallelize large calculations.
All environments support the standard multi-threaded dask scheduler, and by default,
zarr-backed cloud data datasets will open in Xarray as collections of Dask arrays.</p>
<section id="guidelines-for-using-dask">
<h3>Guidelines for using Dask<a class="headerlink" href="#guidelines-for-using-dask" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Familiarize yourself with <a class="reference external" href="https://docs.dask.org/en/latest/array-best-practices.html">Dask best practices</a>.</p></li>
<li><p>Don’t use Dask! Or more specifically, only use a distributed cluster if you really need it, i.e. if your calculations are running out of memory or are taking an unacceptably long time to complete.</p></li>
<li><p>Start small; work on a small subset of your problem to debug before scaling up to a very large dataset.</p></li>
<li><p>If you use a distributed cluster, use <a class="reference external" href="https://jobqueue.dask.org/en/latest/index.html#adaptivity">adapative mode</a> rather than a fixed size cluster; this will help share resources more effectively.</p></li>
<li><p>Use the Dask dashboard heavily to monitor the activity of your cluster.</p></li>
</ul>
</section>
<section id="dask-gateway">
<span id="id3"></span><h3>Dask Gateway<a class="headerlink" href="#dask-gateway" title="Link to this heading">¶</a></h3>
<p>Pangeo cloud environments are configured to work with
<a class="reference external" href="https://gateway.dask.org/">Dask Gateway</a>.
Dask gateway gives you the power to create a distributed cluster using many
cloud compute nodes. <em>Please use this power carefully!</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Avoid large, long-running, idle clusters, which are a waste of Pangeo’s limited cloud computing budget.
Only use a cluster while you need</p>
</div>
<p>To do scalable computations with Dask you need to create a cluster with Dask Gateway
and connect to it</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">GatewayCluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">GatewayCluster</span><span class="p">()</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># or cluster.scale(n) to a fixed size.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</pre></div>
</div>
<p>That will create a Dask cluster with the default settings we’ve configured for
you. From that point, any computations using Dask will be done on the cluster.
The <code class="docutils literal notranslate"><span class="pre">cluster</span></code> and <code class="docutils literal notranslate"><span class="pre">client</span></code> reprs will have a link to your Dask Dashboard.</p>
<p>When you’re done with your computation, you can close the cluster explicitly</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Or restart the notebook kernel, or stop your JupyterHub server. Finally, as
a safeguard, Pangeo will automatically close your Dask cluster if it’s idle
for 60 minutes (but we prefer that you close it yourself if possible, to avoid
paying for unnecessary compute).</p>
<p>If you need to customize things, you’ll need to connect to the Gateway.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">()</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">cluster_options</span><span class="p">()</span>

<span class="c1"># set the options programatically, or through their HTML repr</span>
<span class="n">options</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 10 GB of memory per worker.</span>

<span class="c1"># Create a cluster with those options</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</pre></div>
</div>
<p>Dask Gateway can optionally keep clusters running past the lifetime of your notebook. You can set the cluster shutdown behavior using  the <a class="reference external" href="https://gateway.dask.org/api-client.html?highlight=shutdown_on_close#gatewaycluster/">shutdown_on_close</a> parameter. Note the default setting for the <cite>shutdown_on_close</cite> parameter is different for different API calls.</p>
<p>If you need to reconnect to an <em>already running</em> cluster, to continue a computation
or shut it down, use the <cite>gateway</cite> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">()</span>
<span class="go">[ClusterReport&lt;name=prod.c288c65c429049e788f41d8308823ca8, status=RUNNING&gt;]</span>

<span class="go"># connect to the cluster</span>
<span class="go">cluster = g.connect(g.list_clusters()[0].name)</span>
<span class="go"># shut it down</span>
<span class="go">cluster.close()</span>
</pre></div>
</div>
</section>
<section id="environment-variables-on-the-cluster">
<h3>Environment variables on the cluster<a class="headerlink" href="#environment-variables-on-the-cluster" title="Link to this heading">¶</a></h3>
<p>Some scalable computations running on the cluster depend on environment variables
set on remote processes. In general, environment variables set on your local
Jupyter session will not propagate to the Dask scheduler and workers.</p>
<p>To set environment variables on the scheduler and workers, you must use the
<code class="docutils literal notranslate"><span class="pre">environment</span></code> option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">cluster_options</span><span class="p">()</span>
</pre></div>
</div>
<p>As described in <a class="reference internal" href="#dask-gateway"><span class="std std-ref">Dask Gateway</span></a> these options can be set programmatically
or through the HTML widget. For example, to set the environment variable
<code class="docutils literal notranslate"><span class="pre">MY_VARIABLE</span></code> on our scheduler and workers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">options</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MY_VARIABLE&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Which can be verified with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check</span><span class="p">():</span>
<span class="gp">... </span>    <span class="kn">import</span> <span class="nn">os</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MY_VARIABLE&quot;</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
<span class="go">{&#39;tls://10.36.248.180:33361&#39;: &#39;1&#39;}</span>
</pre></div>
</div>
<p>This can be combined with <a class="reference external" href="https://docs.dask.org/en/latest/configuration.html">Dask’s configuration system</a>
to the Dask scheduler and workers. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;DASK_DISTRIBUTED__SCHEDULER__WORK_STEALING&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;DASK_DISTRIBUTED__SCHEDULER__ALLOWED_FAILURES&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">env</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dask-software-environment">
<h3>Dask Software Environment<a class="headerlink" href="#dask-software-environment" title="Link to this heading">¶</a></h3>
<p>The default image used on Dask Clusters (the scheduler and workers) matches
the image used for JupyterHub. It won’t, however, have changes you’ve made
in your “local” environment in your home directory on the hub.</p>
<p>Long-term, the best way to add packages to the environemnt is by updating the
Docker images, as described in <a class="reference internal" href="#cloud-software-environment"><span class="std std-ref">Software Environment</span></a>. But for quickly
prototyping something on the Dask cluster you can use a the
<a class="reference external" href="https://distributed.dask.org/en/stable/plugins.html#built-in-worker-plugins">Dask PipInstall plugin</a>.
<a class="reference external" href="https://distributed.dask.org/en/latest/plugins.html#distributed.diagnostics.plugin.WorkerPlugin">Dask WorkerPlugin</a>.
To install packages in dask workers (the example below installs <a class="reference external" href="https://pypi.org/project/bulwark/">bulwark</a>),
you’d create a cluster normally and add the plugin, specifying which packages to intall:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">PipInstall</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">GatewayCluster</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span> <span class="o">=</span> <span class="n">GatewayCluster</span><span class="p">()</span>  <span class="c1"># create the cluster nomrally</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now create and register the plugin. We&#39;ll install &#39;bulwark&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plugin</span> <span class="o">=</span> <span class="n">PipInstall</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bulwark&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">register_worker_plugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
</pre></div>
</div>
<p>We can verify the package is now present:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check</span><span class="p">():</span>
<span class="gp">... </span>    <span class="kn">import</span> <span class="nn">bulwark</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">bulwark</span><span class="o">.</span><span class="n">__version__</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_workers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
<span class="go">{&#39;tls://10.36.248.117:40785&#39;: &#39;0.6.1&#39;, &#39;tls://10.37.142.70:43031&#39;: &#39;0.6.1&#39;}</span>
</pre></div>
</div>
<p>A few caveats are in order:</p>
<ol class="arabic simple">
<li><p>You should register the plugin before scaling to ensure that your packages
are installed on all the workers.</p></li>
<li><p>You should take care with dependencies. Pip doesn’t always respect packages
that have been installed with conda.</p></li>
<li><p>If you need to <em>upgrade existing</em> packages, take special care. You may need
to <code class="docutils literal notranslate"><span class="pre">client.restart()</span></code> the cluster to ensure that the new packages are
used.</p></li>
<li><p>This will slow down the startup time of your workers, especially if the
package takes a while to install.</p></li>
</ol>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018-2023, Pangeo Team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4K4N4RYC53"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4K4N4RYC53');
</script>
  </body>
</html>